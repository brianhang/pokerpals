{% extends "layout.html" %}
{% from "game/title.html" import game_title %}


{% macro player_item(player) %}
<div class="player-item">
    <h3>
        <a href="https://www.venmo.com/{{ player.player_venmo_username }}/">
            {{ player.player_venmo_username }}
        </a>
    </h3>
    <div class="player-info">
        <ul>
            {% if player.buyin_cents > 0 %}
            <li><strong>Bought in</strong>: ${{ player.buyin_text() }}</li>
            {% else %}
            <li>Spectating</li>
            {% endif %}
            {% if player.cashout_cents is not none %}
            <li><strong>Cashed out</strong>: ${{ player.cashout_text() }}</li>
            {% endif %}
        </ul>
    </div>
</div>
{% endmacro %}

{% block body %}
<div class="container">
    {% if venmo_url and pending_payment %}
    <div class="venmo-cta">
        <a href="{{ venmo_url }}">Venmo {{ pending_payment.to_player_id }}</a>
    </div>
    {% endif %}
    <div>
        {{ game_title(game) }}
        <div class="secondary"><em>Created by <a href="https://venmo.com/{{ game.creator_id }}/">{{ game.creator_id
                    }}</a> on {{ game.human_created_time() }}</em></div>
        <ul>
            {% if player.active_game_id == game.id or game.creator_id == player.venmo_username %}
            <li><strong>Entry Code</strong>: <a
                    href="/game/join/{{ game.id }}/?code={{ game.entry_code }}"><code>{{ game.entry_code }}</code></a>
            </li>
            {% endif %}
            <li><strong>Buyin</strong>: ${{ buyin_amount }}</li>
            <li><strong>Buyin Total</strong>: ${{ buyin_total }}</li>
            <li><strong>Cash Out Total</strong>: ${{ cashout_total }}</li>
        </ul>
    </div>
    {% if player and game.is_active %}
    {% if player.venmo_username == game.creator_id %}
    <div id="game-admin-actions">
        <h3>Game Actions</h3>
        <ul>
            <li><a href="/game/end/{{ game.id }}/">End Game</a></li>
        </ul>
    </div>
    {% endif %}
    {% if player.active_game_id == game.id %}
    <div id="game-player-actions">
        <h3>Player Actions</h3>
        <ul>
            <li><a href="/game/buyin/">Buy In</a></li>
            {% if game_player.buyin_cents > 0 %}
            <li><a href="/game/cashout/">Cash Out</a></li>
            {% endif %}
        </ul>
    </div>
    {% elif not player.active_game_id %}
    <div id="game-player-actions">
        <h3>Player Actions</h3>
        <ul>
            <li><a href="/game/join/{{ game.id }}/">Join Game</a></li>
        </ul>
    </div>
    {% endif %}
    {% endif %}
    <div>
        <h3>Players</h3>
        <div class="player-list">
            {% for player in players.players %}
            {{ player_item(player) }}
            {% endfor %}
        </div>
    </div>
    {% if payments %}
    <div class="game-payments">
        <h3>Payments</h3>
        <ul>
            {% for payment in payments %}
            <li>
                <a href="https://www.venmo.com/{{ payment.from_player_id }}/">{{ payment.from_player_id }}</a>
                sends ${{ payment.amount_text() }} to
                <a href="https://www.venmo.com/{{ payment.to_player_id }}/">{{ payment.to_player_id }}</a>
            </li>
            {% endfor %}
        </ul>
    </div>
    {% endif %}
</div>
{% endblock %}
